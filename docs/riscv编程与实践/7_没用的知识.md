## 硬盘的构造和工作原理

软盘是一种早期的存储设备，已经过时了，下面是3种硬盘：

U盘，采用USB接口

机械硬盘，简称HDD，是机械和电子技术的混合体

固态硬盘，简称SSD，纯粹由集成电路组成

以机械硬盘为例子，它有多个盘片，正反都可以存储数据。转速每分钟千转到万转，形成一个一个圆圈，称为磁道。磁头臂可以带动读写磁头到不同的磁道上读写，读写的最小单位是扇区，它是磁道的一个弧段，固定是512Byte。柱面是指半径相同的磁道形成的圆柱面，扇面是指盘片的一个面。

因为磁头臂切换磁道的速度相较于读写很慢，所以都是按照一个一个柱面读写的：

![image-20230918231702417](assets/image-20230918231702417.png)

8086CPU有一步是将硬盘主引导扇区读到内存地址07C00处，然后用一个跳转指令跳到07C00处执行。在硬盘上 0面0柱1扇区 就是主引导扇区，如果想让.bin绕过操作系统被硬件直接执行，就可以把它放到主引导扇区

比如下面的.bin文件：

主引导扇区必须凑够512个字节。此外要让主引导扇区被识别，最后2个字节还必须是55AA

```nasm
;B8 30 00 BA C0 00 01 D0
mov ax,0x30
mov dx,0xc0
add ax,dx

times 502 db 0		;用 0 填充满 502 个字节

db 0x55,0xaa 		;主引导扇区最后两个字节必须是 0x55aa
```

可以用二进制查看工具查看.bin文件

然后用`dd`命令把它写入到虚拟硬盘，`count`选项指定只读取一个扇区

将 boot.bin 文件写入到 /dev/fd0 设备（通常是软盘驱动器）的第一个扇区：

```shell
dd if=boot.bin of=/dev/fdo bs=512 count=1
```



### 虚拟硬盘

不同公司对如何模拟硬盘有不同的想法，所以出现了多种不同的虚拟硬盘格式

VMDK（VMWare虚拟机的硬盘格式）

VDI （VirtualBox虚拟机的硬盘格式）

VHD（Virtual-PC/Hyper-V虚拟机的硬盘格式）

VHD的硬盘格式比较简单，就是按照扇区的顺序，每512字节对应一个硬盘上的扇区